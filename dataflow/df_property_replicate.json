{
	"name": "df_property_replicate",
	"properties": {
		"type": "MappingDataFlow",
		"typeProperties": {
			"sources": [
				{
					"linkedService": {
						"referenceName": "CincinnatiMLSRest",
						"type": "LinkedServiceReference"
					},
					"name": "source1",
					"description": "{@odata.nextLink}"
				}
			],
			"sinks": [
				{
					"linkedService": {
						"referenceName": "CosmosDbNoSql",
						"type": "LinkedServiceReference"
					},
					"name": "sink1"
				}
			],
			"transformations": [
				{
					"name": "flatten1"
				},
				{
					"name": "AlterRow1"
				},
				{
					"name": "select1"
				},
				{
					"name": "ConvertNumberFieldsToString"
				},
				{
					"name": "ConvertPriceFieldsToInt"
				},
				{
					"name": "TEST"
				}
			],
			"scriptLines": [
				"source(output(",
				"          body as ({@odata.context} as string, {@odata.nextLink} as string, value as ({@odata.context} as string, {@odata.id} as string, AboveGradeFinishedArea as double, Appliances as string[], ArchitecturalStyle as string[], AssociationFee as double, AssociationFeeFrequency as string, AssociationFeeIncludes as string[], AssociationYN as boolean, AuctionOnlineBidYN as boolean, Basement as string[], BathroomsFull as short, BathroomsHalf as short, BathroomsOneQuarter as boolean, BathroomsThreeQuarter as boolean, BedroomsPossible as boolean, BedroomsTotal as short, BuyerAgencyCompensation as string, BuyerAgentFullName as string, BuyerAgentKey as integer, BuyerAgentKeyNumeric as integer, BuyerAgentMlsId as string, BuyerFinancing as string[], BuyerOfficeKey as integer, BuyerOfficeKeyNumeric as integer, BuyerOfficeMlsId as string, BuyerOfficeName as string, CancellationDate as date, CarportSpaces as double, CeilingHeight as double, City as string, CloseDate as date, ClosePrice as double, CoBuyerAgentKey as integer, CoBuyerAgentKeyNumeric as integer, CoBuyerOfficeKey as integer, CoBuyerOfficeKeyNumeric as integer, CoListAgentKey as integer, CoListAgentKeyNumeric as integer, CoListOfficeKey as integer, CoListOfficeKeyNumeric as integer, ConstructionMaterials as string[], ContractStatusChangeDate as date, Cooling as string[], CountyOrParish as string, CumulativeDaysOnMarket as short, DaysOnMarket as short, Directions as string, Disclaimer as string, Electric as string[], Fencing as string[], FireplaceFeatures as string[], FireplacesTotal as short, Flooring as string[], FoundationDetails as string[], GarageSpaces as double, GreenVerificationYN as boolean, GrossIncome as double, Heating as string[], HighSchoolDistrict as string, InsuranceExpense as double, InteriorFeatures as string[], InternetAddressDisplayYN as boolean, InternetAutomatedValuationDisplayYN as boolean, InternetEntireListingDisplayYN as boolean, Latitude as double, LeaseConsideredYN as boolean, LeaseTerm as string, Levels as string[], ListAgentFirstName as string, ListAgentFullName as string, ListAgentKey as integer, ListAgentKeyNumeric as integer, ListAgentLastName as string, ListAgentMlsId as integer, ListOfficeKey as integer, ListOfficeKeyNumeric as integer, ListOfficeMlsId as string, ListOfficeName as string, ListPrice as double, ListingContractDate as date, ListingId as integer, ListingKey as integer, ListingKeyNumeric as integer, ListingURL as string, LivingArea as double, Longitude as double, LotFeatures as string[], LotSizeAcres as double, LotSizeArea as double, LotSizeDimensions as string, LotSizeSquareFeet as double, LotSizeUnits as string, MajorChangeTimestamp as string, MajorChangeType as string, Media as (MediaCategory as string, MediaKey as string, MediaModificationTimestamp as string, MediaURL as string, Order as short, OriginatingSystemID as string, Permission as string[], ResourceName as string, ResourceRecordID as integer, ResourceRecordKey as integer)[], ModificationTimestamp as string, NewConstructionYN as boolean, NumberOfBuildings as short, NumberOfUnitsTotal as short, OccupantName as string, OffMarketTimestamp as string, OnMarketDate as date, OriginalEntryTimestamp as string, OriginalListPrice as double, OriginatingSystemID as string, OriginatingSystemName as string, OtherStructures as string[], OwnerPays as string[], ParcelNumber as string, ParkingFeatures as string[], PatioAndPorchFeatures as string[], PhotosChangeTimestamp as string, PhotosCount as short, Possession as string[], PostalCode as integer, PostalCodePlus4 as short, PriceChangeTimestamp as string, PrivateRemarks as string, PropertyAttachedYN as boolean, PropertyCondition as string[], PropertySubType as string, PropertyType as string, PublicRemarks as string, PurchaseContractDate as date, Roof as string[], Rooms as (Level as string, RoomArea as short, RoomDimensions as string, RoomFeatures as string[], RoomLength as short, RoomLevel as string, RoomType as string, RoomWidth as short)[], RoomsTotal as double, SeniorCommunityYN as boolean, Sewer as string[], ShowingInstructions as string, StandardStatus as string, StateOrProvince as string, StatusChangeTimestamp as string, StreetName as string, StreetNumber as short, StreetSuffix as string, StructureType as string[], SubAgencyCompensation as string, SubdivisionName as string, TenantPays as string[], Township as string, TransactionBrokerCompensation as string, UnitNumber as string, Utilities as string[], VideosChangeTimestamp as string, WaterSewerExpense as double, WaterSource as string[], WindowFeatures as string[], YearBuilt as short, Zoning as string, ZoningTypes as string[])[]),",
				"          headers as [string,string]",
				"     ),",
				"     allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     limit: 100,",
				"     format: 'rest',",
				"     timeout: 30,",
				"     requestInterval: 0,",
				"     entity: '/api/v1/OData/cincymls/Property?$filter=CloseDate%20ge%202022-10-01',",
				"     httpMethod: 'GET',",
				"     responseFormat: ['type' -> 'json', 'documentForm' -> 'documentPerLine'],",
				"     preferredIntegralType: 'long') ~> source1",
				"source1 foldDown(unroll(body.value, body.value),",
				"     mapColumn(",
				"          {@odata.context} = body.value.{@odata.context},",
				"          {@odata.id} = body.value.{@odata.id},",
				"          AboveGradeFinishedArea = body.value.AboveGradeFinishedArea,",
				"          Appliances = body.value.Appliances,",
				"          ArchitecturalStyle = body.value.ArchitecturalStyle,",
				"          AssociationFee = body.value.AssociationFee,",
				"          AssociationFeeFrequency = body.value.AssociationFeeFrequency,",
				"          AssociationFeeIncludes = body.value.AssociationFeeIncludes,",
				"          AssociationYN = body.value.AssociationYN,",
				"          AuctionOnlineBidYN = body.value.AuctionOnlineBidYN,",
				"          Basement = body.value.Basement,",
				"          BathroomsFull = body.value.BathroomsFull,",
				"          BathroomsHalf = body.value.BathroomsHalf,",
				"          BathroomsOneQuarter = body.value.BathroomsOneQuarter,",
				"          BathroomsThreeQuarter = body.value.BathroomsThreeQuarter,",
				"          BedroomsPossible = body.value.BedroomsPossible,",
				"          BedroomsTotal = body.value.BedroomsTotal,",
				"          BuyerAgencyCompensation = body.value.BuyerAgencyCompensation,",
				"          BuyerAgentFullName = body.value.BuyerAgentFullName,",
				"          BuyerAgentKey = body.value.BuyerAgentKey,",
				"          BuyerAgentKeyNumeric = body.value.BuyerAgentKeyNumeric,",
				"          BuyerAgentMlsId = body.value.BuyerAgentMlsId,",
				"          BuyerFinancing = body.value.BuyerFinancing,",
				"          BuyerOfficeKey = body.value.BuyerOfficeKey,",
				"          BuyerOfficeKeyNumeric = body.value.BuyerOfficeKeyNumeric,",
				"          BuyerOfficeMlsId = body.value.BuyerOfficeMlsId,",
				"          BuyerOfficeName = body.value.BuyerOfficeName,",
				"          CancellationDate = body.value.CancellationDate,",
				"          CarportSpaces = body.value.CarportSpaces,",
				"          CeilingHeight = body.value.CeilingHeight,",
				"          City = body.value.City,",
				"          CloseDate = body.value.CloseDate,",
				"          ClosePrice = body.value.ClosePrice,",
				"          CoBuyerAgentKey = body.value.CoBuyerAgentKey,",
				"          CoBuyerAgentKeyNumeric = body.value.CoBuyerAgentKeyNumeric,",
				"          CoBuyerOfficeKey = body.value.CoBuyerOfficeKey,",
				"          CoBuyerOfficeKeyNumeric = body.value.CoBuyerOfficeKeyNumeric,",
				"          CoListAgentKey = body.value.CoListAgentKey,",
				"          CoListAgentKeyNumeric = body.value.CoListAgentKeyNumeric,",
				"          CoListOfficeKey = body.value.CoListOfficeKey,",
				"          CoListOfficeKeyNumeric = body.value.CoListOfficeKeyNumeric,",
				"          ConstructionMaterials = body.value.ConstructionMaterials,",
				"          ContractStatusChangeDate = body.value.ContractStatusChangeDate,",
				"          Cooling = body.value.Cooling,",
				"          CountyOrParish = body.value.CountyOrParish,",
				"          CumulativeDaysOnMarket = body.value.CumulativeDaysOnMarket,",
				"          DaysOnMarket = body.value.DaysOnMarket,",
				"          Directions = body.value.Directions,",
				"          Disclaimer = body.value.Disclaimer,",
				"          Electric = body.value.Electric,",
				"          Fencing = body.value.Fencing,",
				"          FireplaceFeatures = body.value.FireplaceFeatures,",
				"          FireplacesTotal = body.value.FireplacesTotal,",
				"          Flooring = body.value.Flooring,",
				"          FoundationDetails = body.value.FoundationDetails,",
				"          GarageSpaces = body.value.GarageSpaces,",
				"          GreenVerificationYN = body.value.GreenVerificationYN,",
				"          GrossIncome = body.value.GrossIncome,",
				"          Heating = body.value.Heating,",
				"          HighSchoolDistrict = body.value.HighSchoolDistrict,",
				"          InsuranceExpense = body.value.InsuranceExpense,",
				"          InteriorFeatures = body.value.InteriorFeatures,",
				"          InternetAddressDisplayYN = body.value.InternetAddressDisplayYN,",
				"          InternetAutomatedValuationDisplayYN = body.value.InternetAutomatedValuationDisplayYN,",
				"          InternetEntireListingDisplayYN = body.value.InternetEntireListingDisplayYN,",
				"          Latitude = body.value.Latitude,",
				"          LeaseConsideredYN = body.value.LeaseConsideredYN,",
				"          LeaseTerm = body.value.LeaseTerm,",
				"          Levels = body.value.Levels,",
				"          ListAgentFirstName = body.value.ListAgentFirstName,",
				"          ListAgentFullName = body.value.ListAgentFullName,",
				"          ListAgentKey = body.value.ListAgentKey,",
				"          ListAgentKeyNumeric = body.value.ListAgentKeyNumeric,",
				"          ListAgentLastName = body.value.ListAgentLastName,",
				"          ListAgentMlsId = body.value.ListAgentMlsId,",
				"          ListOfficeKey = body.value.ListOfficeKey,",
				"          ListOfficeKeyNumeric = body.value.ListOfficeKeyNumeric,",
				"          ListOfficeMlsId = body.value.ListOfficeMlsId,",
				"          ListOfficeName = body.value.ListOfficeName,",
				"          ListPrice = body.value.ListPrice,",
				"          ListingContractDate = body.value.ListingContractDate,",
				"          ListingId = body.value.ListingId,",
				"          ListingKey = body.value.ListingKey,",
				"          ListingKeyNumeric = body.value.ListingKeyNumeric,",
				"          ListingURL = body.value.ListingURL,",
				"          LivingArea = body.value.LivingArea,",
				"          Longitude = body.value.Longitude,",
				"          LotFeatures = body.value.LotFeatures,",
				"          LotSizeAcres = body.value.LotSizeAcres,",
				"          LotSizeArea = body.value.LotSizeArea,",
				"          LotSizeDimensions = body.value.LotSizeDimensions,",
				"          LotSizeSquareFeet = body.value.LotSizeSquareFeet,",
				"          LotSizeUnits = body.value.LotSizeUnits,",
				"          MajorChangeTimestamp = body.value.MajorChangeTimestamp,",
				"          MajorChangeType = body.value.MajorChangeType,",
				"          Media = body.value.Media,",
				"          ModificationTimestamp = body.value.ModificationTimestamp,",
				"          NewConstructionYN = body.value.NewConstructionYN,",
				"          NumberOfBuildings = body.value.NumberOfBuildings,",
				"          NumberOfUnitsTotal = body.value.NumberOfUnitsTotal,",
				"          OccupantName = body.value.OccupantName,",
				"          OffMarketTimestamp = body.value.OffMarketTimestamp,",
				"          OnMarketDate = body.value.OnMarketDate,",
				"          OriginalEntryTimestamp = body.value.OriginalEntryTimestamp,",
				"          OriginalListPrice = body.value.OriginalListPrice,",
				"          OriginatingSystemID = body.value.OriginatingSystemID,",
				"          OriginatingSystemName = body.value.OriginatingSystemName,",
				"          OtherStructures = body.value.OtherStructures,",
				"          OwnerPays = body.value.OwnerPays,",
				"          ParcelNumber = body.value.ParcelNumber,",
				"          ParkingFeatures = body.value.ParkingFeatures,",
				"          PatioAndPorchFeatures = body.value.PatioAndPorchFeatures,",
				"          PhotosChangeTimestamp = body.value.PhotosChangeTimestamp,",
				"          PhotosCount = body.value.PhotosCount,",
				"          Possession = body.value.Possession,",
				"          PostalCode = body.value.PostalCode,",
				"          PostalCodePlus4 = body.value.PostalCodePlus4,",
				"          PriceChangeTimestamp = body.value.PriceChangeTimestamp,",
				"          PrivateRemarks = body.value.PrivateRemarks,",
				"          PropertyAttachedYN = body.value.PropertyAttachedYN,",
				"          PropertyCondition = body.value.PropertyCondition,",
				"          PropertySubType = body.value.PropertySubType,",
				"          PropertyType = body.value.PropertyType,",
				"          PublicRemarks = body.value.PublicRemarks,",
				"          PurchaseContractDate = body.value.PurchaseContractDate,",
				"          Roof = body.value.Roof,",
				"          Rooms = body.value.Rooms,",
				"          RoomsTotal = body.value.RoomsTotal,",
				"          SeniorCommunityYN = body.value.SeniorCommunityYN,",
				"          Sewer = body.value.Sewer,",
				"          ShowingInstructions = body.value.ShowingInstructions,",
				"          StandardStatus = body.value.StandardStatus,",
				"          StateOrProvince = body.value.StateOrProvince,",
				"          StatusChangeTimestamp = body.value.StatusChangeTimestamp,",
				"          StreetName = body.value.StreetName,",
				"          StreetNumber = body.value.StreetNumber,",
				"          StreetSuffix = body.value.StreetSuffix,",
				"          StructureType = body.value.StructureType,",
				"          SubAgencyCompensation = body.value.SubAgencyCompensation,",
				"          SubdivisionName = body.value.SubdivisionName,",
				"          TenantPays = body.value.TenantPays,",
				"          Township = body.value.Township,",
				"          TransactionBrokerCompensation = body.value.TransactionBrokerCompensation,",
				"          UnitNumber = body.value.UnitNumber,",
				"          Utilities = body.value.Utilities,",
				"          VideosChangeTimestamp = body.value.VideosChangeTimestamp,",
				"          WaterSewerExpense = body.value.WaterSewerExpense,",
				"          WaterSource = body.value.WaterSource,",
				"          WindowFeatures = body.value.WindowFeatures,",
				"          YearBuilt = body.value.YearBuilt,",
				"          Zoning = body.value.Zoning,",
				"          ZoningTypes = body.value.ZoningTypes",
				"     ),",
				"     skipDuplicateMapInputs: false,",
				"     skipDuplicateMapOutputs: false) ~> flatten1",
				"ConvertNumberFieldsToString alterRow(upsertIf(true())) ~> AlterRow1",
				"flatten1 select(mapColumn(",
				"          {odata.id} = {@odata.id},",
				"          id = ListingKey,",
				"          each(match(!in(['@odata.id','ListingKey'],name)))",
				"     ),",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true) ~> select1",
				"ConvertPriceFieldsToInt derive(each(match(typeMatch(type,'datetime')||typeMatch(type,'number')||typeMatch(type,'short')), $$ = toString($$))) ~> ConvertNumberFieldsToString",
				"TEST derive(each(match(type=='short'), $$ = toInteger($$))) ~> ConvertPriceFieldsToInt",
				"select1 select(mapColumn(",
				"          id = {odata.id},",
				"          id,",
				"          context = {@odata.context},",
				"          AboveGradeFinishedArea,",
				"          Appliances,",
				"          ArchitecturalStyle,",
				"          AssociationFee,",
				"          AssociationFeeFrequency,",
				"          AssociationFeeIncludes,",
				"          AssociationYN,",
				"          AuctionOnlineBidYN,",
				"          Basement,",
				"          BathroomsFull,",
				"          BathroomsHalf,",
				"          BathroomsOneQuarter,",
				"          BathroomsThreeQuarter,",
				"          BedroomsPossible,",
				"          BedroomsTotal,",
				"          BuyerAgencyCompensation,",
				"          BuyerAgentFullName,",
				"          BuyerAgentKey,",
				"          BuyerAgentKeyNumeric,",
				"          BuyerAgentMlsId,",
				"          BuyerFinancing,",
				"          BuyerOfficeKey,",
				"          BuyerOfficeKeyNumeric,",
				"          BuyerOfficeMlsId,",
				"          BuyerOfficeName,",
				"          CancellationDate,",
				"          CarportSpaces,",
				"          CeilingHeight,",
				"          City,",
				"          CloseDate,",
				"          ClosePrice,",
				"          CoBuyerAgentKey,",
				"          CoBuyerAgentKeyNumeric,",
				"          CoBuyerOfficeKey,",
				"          CoBuyerOfficeKeyNumeric,",
				"          CoListAgentKey,",
				"          CoListAgentKeyNumeric,",
				"          CoListOfficeKey,",
				"          CoListOfficeKeyNumeric,",
				"          ConstructionMaterials,",
				"          ContractStatusChangeDate,",
				"          Cooling,",
				"          CountyOrParish,",
				"          CumulativeDaysOnMarket,",
				"          DaysOnMarket,",
				"          Directions,",
				"          Disclaimer,",
				"          Electric,",
				"          Fencing,",
				"          FireplaceFeatures,",
				"          FireplacesTotal,",
				"          Flooring,",
				"          FoundationDetails,",
				"          GarageSpaces,",
				"          GreenVerificationYN,",
				"          GrossIncome,",
				"          Heating,",
				"          HighSchoolDistrict,",
				"          InsuranceExpense,",
				"          InteriorFeatures,",
				"          InternetAddressDisplayYN,",
				"          InternetAutomatedValuationDisplayYN,",
				"          InternetEntireListingDisplayYN,",
				"          Latitude,",
				"          LeaseConsideredYN,",
				"          LeaseTerm,",
				"          Levels,",
				"          ListAgentFirstName,",
				"          ListAgentFullName,",
				"          ListAgentKey,",
				"          ListAgentKeyNumeric,",
				"          ListAgentLastName,",
				"          ListAgentMlsId,",
				"          ListOfficeKey,",
				"          ListOfficeKeyNumeric,",
				"          ListOfficeMlsId,",
				"          ListOfficeName,",
				"          ListPrice,",
				"          ListingContractDate,",
				"          ListingId,",
				"          ListingKeyNumeric,",
				"          ListingURL,",
				"          LivingArea,",
				"          Longitude,",
				"          LotFeatures,",
				"          LotSizeAcres,",
				"          LotSizeArea,",
				"          LotSizeDimensions,",
				"          LotSizeSquareFeet,",
				"          LotSizeUnits,",
				"          MajorChangeTimestamp,",
				"          MajorChangeType,",
				"          Media,",
				"          ModificationTimestamp,",
				"          NewConstructionYN,",
				"          NumberOfBuildings,",
				"          NumberOfUnitsTotal,",
				"          OccupantName,",
				"          OffMarketTimestamp,",
				"          OnMarketDate,",
				"          OriginalEntryTimestamp,",
				"          OriginalListPrice,",
				"          OriginatingSystemID,",
				"          OriginatingSystemName,",
				"          OtherStructures,",
				"          OwnerPays,",
				"          ParcelNumber,",
				"          ParkingFeatures,",
				"          PatioAndPorchFeatures,",
				"          PhotosChangeTimestamp,",
				"          PhotosCount,",
				"          Possession,",
				"          PostalCode,",
				"          PostalCodePlus4,",
				"          PriceChangeTimestamp,",
				"          PrivateRemarks,",
				"          PropertyAttachedYN,",
				"          PropertyCondition,",
				"          PropertySubType,",
				"          PropertyType,",
				"          PublicRemarks,",
				"          PurchaseContractDate,",
				"          Roof,",
				"          Rooms,",
				"          RoomsTotal,",
				"          SeniorCommunityYN,",
				"          Sewer,",
				"          ShowingInstructions,",
				"          StandardStatus,",
				"          StateOrProvince,",
				"          StatusChangeTimestamp,",
				"          StreetName,",
				"          StreetNumber,",
				"          StreetSuffix,",
				"          StructureType,",
				"          SubAgencyCompensation,",
				"          SubdivisionName,",
				"          TenantPays,",
				"          Township,",
				"          TransactionBrokerCompensation,",
				"          UnitNumber,",
				"          Utilities,",
				"          VideosChangeTimestamp,",
				"          WaterSewerExpense,",
				"          WaterSource,",
				"          WindowFeatures,",
				"          YearBuilt,",
				"          Zoning,",
				"          ZoningTypes",
				"     ),",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true) ~> TEST",
				"AlterRow1 sink(allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     format: 'document',",
				"     container: 'Property',",
				"     deletable: false,",
				"     insertable: false,",
				"     updateable: false,",
				"     upsertable: true,",
				"     store: 'cosmosDB',",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true) ~> sink1"
			]
		}
	}
}